{
  "$id": "http://rapier.io/config-v1/schema#",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "name": "APIcast config",
  "summary": "Configures the standalone version of APIcast proxy.",
  "description": "Configures the standalone version of APIcast proxy.",
  "version": "1.0.0",
  "type": "object",
  "definitions": {
    "service": {
      "$id": "#service",
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "policy_chain": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "apicast.policy.echo",
              "apicast.policy.cors",
              "apicast.policy.caching",
              "apicast.policy.conditional",
              "apicast.policy.default_credentials",
              "apicast.policy.find_service",
              "apicast.policy.headers",
              "apicast.policy.ip_check",
              "apicast.policy.keycloack_role_check",
              "apicast.policy.liquid_context_debug",
              "apicast.policy.load_configuration",
              "apicast.policy.local_chain",
              "apicast.policy.logging",
              "apicast.policy.management",
              "apicast.policy.routing",
              "apicast.policy.soap",
              "apicast.policy.url_rewriting",
              "apicast.policy.standalone"
            ]
          }
        }
      }
    }
  },
  "properties": {
    "global" : {
      "type": "object",
      "properties": {
        "log_level": {
          "description": "Log level",
          "type": "string",
          "title": "Debug log level.",
          "default": "emerg",
          "enum": [
            "debug",
            "emerg"
          ],
          "enumNames": [
            "Debug",
            "Emerg"
          ]
        },
        "error_log": {
          "description": "Error Log",
          "type": "string",
          "title": "Error log level.",
          "enum": [
            "stderr",
            "/dev/null",
            "none"
          ],
          "enumNames": [
            "stderr",
            "Silent",
            "No logging at all."
          ]
        },
        "access_log": {
          "description": "Access Log",
          "type": "string",
          "title": "Access Log",
          "enum": [
            "stdout",
            "silent",
            "none"
          ],
          "enumNames": [
            "stdout",
            "Silent",
            "No logging at all."
          ]
        },
        "opentracing_tracer": {
          "description": "Opentracing Tracer",
          "type": "string",
          "title": "Tracer",
          "enum": [
            "jaeger",
            "other",
            "none"
          ],
          "enumNames": [
            "Jaeger",
            "Other maybe?",
            "None"
          ]
        }
      }
    },
    "server": {
      "type": "object",
      "properties": {
        "listen": {
          "type": "array",
          "title": "List of ports and services the proxy listens and forward to",
          "items": {
            "type": "object",
            "properties": {
              "port": {
                "type": "integer"
              },
              "name": {
                "type": "string",
                "title": "Service",
                "description": "choose a service motherfucker",
                "$enum": "#/internal/name"
              }
            }
          }
        }
      }
    },
    "internal": {
      "type": "array",
      "title": "List of Internal Services",
      "items": {
        "type": "object",
        "properties": {
          "policy": {
            "$ref": "#/definitions/service"
          }
        }
      }
    },
    "routes": {
      "type": "array",
      "title": "Routes",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "match": {
            "type": "object",
            "properties": {
              "uri_path": {
                "type": "string"
              },
              "http_method": {
                "type": "string"
              }
            }
          },
          "destination": {
            "type": "object",
            "title": "Service",
            "description": "choose a service motherfucker",
            "properties": {
              "service": {
                "$enum": "#/internal/name"
              }
            }
          }
        }
      }
    }
  }
}
